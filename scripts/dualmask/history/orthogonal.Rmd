```{r}
require(lme4)
require(ggplot2)

df <- read.csv("dualmask-final.csv")
df.nona <- df[!is.na(df$rt), ] # remove bad trials so ggplot doesn't get mad
head(df)

# plot just the means
ggplot(df.nona, aes(x = mask_c, y = rt, color = cue_type)) +
  stat_summary(fun.y = mean, geom = "point", size = 3.0)

# fit a model with just the linear interaction
unique(df.nona[,c("cue_type", "cue_l")])
mod1 <- lmer(rt ~ cue_l * mask_c + (1|subj_id) + (1|pic), data = df, REML = FALSE)
summary(mod1)$coefficients

# model comparison
mod1.chisqr <- anova(mod1, update(mod1, . ~ . - cue_l:mask_c))
mod1.chisqr

ggplot(df.nona, aes(x = mask_c, y = rt, color = cue_type)) +
  stat_summary(fun.y = mean, geom = "point", size = 3.0) +
  stat_summary(aes(y = fitted(mod1)), fun.data = mean_se, geom = "line")

# fit a model with both the linear and the quadratic terms
unique(df.nona[,c("cue_type", "cue_l", "cue_q")])
mod2 <- lmer(rt ~ (cue_l + cue_q) * mask_c + (1|subj_id) + (1|pic), data = df, REML = FALSE)
summary(mod2)$coefficients

# model comparison
mod2.chisqr <- anova(mod2, update(mod2, . ~ . - cue_l:mask_c))
mod2.chisqr

ggplot(df.nona, aes(x = mask_c, y = rt, color = cue_type)) +
  stat_summary(fun.y = mean, geom = "point") +
  stat_summary(aes(y = fitted(mod1)), fun.data = mean_se, geom = "line") +
  stat_summary(aes(y = fitted(mod2)), fun.data = mean_se, geom = "line", linetype = 2)
```